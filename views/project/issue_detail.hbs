{{#> modal }}
{{/modal}}

<main class="d-flex h-100 overflow-hidden">
  {{>sidebar}}
  <div id="content" class="h-100 overflow-auto p-4" style="width: 80%; ">
    <div class="container-fluid m-2">
      <!-- Header -->
      <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">
          <a href=".." style="text-decoration: none; color: inherit;">Issues</a>
          /
          <a href="#" style="text-decoration: none; color: inherit;">{{issueId}}</a>
        </h1>

        <button id="btn-track" type="button" class="btn btn-primary" data-toggle="modal">
          Track issue <i class="fa fa-bell"></i>
        </button>
      </div>

      <!-- Main content -->

      <!-- Content Row: Comments -->
      <div id="comments-container" class="row my-2">

      </div>

      <!-- Content Row -->
      <div class="row mx-auto">
        <div class="container">
          <form id="comment-form" class="container">
            <div class="mb-3">
              <label for="comment" class="form-label">Update issue status:</label>
              <textarea class="form-control" id="comment" name="comment" rows="3"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
          </form>
          <div id="message" class="mt-3"></div>
        </div>
      </div>
    </div>
  </div>
</main>

<script>
  const trackBtn = document.getElementById("btn-track");
  let tracked = false;
  trackBtn.addEventListener("click", () => {
    if (tracked === false) {
      trackBtn.innerText = "Untrack issue";
      trackBtn.classList.replace("btn-primary", "btn-secondary");
    } else if (tracked === true) {
      trackBtn.innerHTML = "Track issue <i class='fa fa-bell'></i>";
      trackBtn.classList.replace("btn-secondary", "btn-primary");
    }
    tracked = !tracked;
  })
</script>

<!-- Load comments scripts -->
<script src="/js/comment/comments.js"></script>
<script>
  displayComments("{{issueId}}");
</script>

<!-- Post comment scripts -->
<script>
  document.getElementById("comment-form").addEventListener("submit", function(event) {
    event.preventDefault();

    const comment = document.getElementById("comment").value.trim();

    if (comment === "") {
      showMessage("Comment must not be empty.", "text-danger");
      return;
    }

    clearCommentField();
    addComment(comment);
    showMessage("Comment submitted successfully.", "text-success");
  });

  const showMessage = (message, className) => {
    const messageElement = document.getElementById("message");
    messageElement.textContent = message;
    messageElement.className = className;
  }

  const clearCommentField = () => {
    document.getElementById("comment").value = "";
  }
</script>